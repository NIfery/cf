<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.it.cf.board.model.BoardDAO">
	
	<sql id="searchForm">
		<if test="searchKeyword!=null and searchKeyword!=''">
			where ${searchCondition}  like '%' || #{searchKeyword} || '%'
		</if>
	</sql>
	
	<sql id="searchNum">
		<if test="searchKeyword == board_No">
			where ${searchCondition}=#{searchKeyword}
		</if>
	</sql>
	
	<insert id="boardWrite" parameterType="boardVo">
	<!--<selectKey keyColumn="boardNo" resultType="int" order="BEFORE">
			select board2_seq.nextval from dual
		</selectKey> -->
		insert into board2(board_No,USER_NAME,board_Title,board_Content,board_Filename,board_Oldfilename,board_Filesize)
		values(board2_seq.nextval,#{userName},#{boardTitle},#{boardContent},#{boardFilename},#{boardOldfilename},#{boardFilesize})
	</insert>
	
	<select id="selectAll" parameterType="SearchVO" resultType="boardVo">
		select *
      from
      (
          select rownum as RNUM,A.*
          from
          (
              select b.*, (sysdate-board_regdate)*24 as newImg
              from board2 b
			<include refid="searchForm"></include>
              order by BOARD_NO desc
          )A
      )
      <![CDATA[
      where RNUM > #{firstRecordIndex} 
      and RNUM <= #{firstRecordIndex} + #{recordCountPerPage}
      ]]>
	</select>
	
	<select id="TotalRecord" parameterType="SearchVo" resultType="int">
		select count(*) from board2 
        <include refid="searchForm"></include>
	</select>
	
	 <update id="updateReadCount" parameterType="int">
 		update board2
 		set board_readcount=board_readcount+1
 		where board_No=#{boardNo}
 	</update>
	
	<select id="selectByNo" resultType="boardVo" parameterType="int">
		select * from board2
		where board_No =#{boardNo}
	</select>
	
	 <update id="updateDownCount" parameterType="int">
	 	update board2
	 	set BOARD_DOWNCOUNT = BOARD_DOWNCOUNT +1
	 	where BOARD_NO=#{boardNo}
	 </update>
	 
	 <update id="EditBoard" parameterType="boardVo">
	 	update board2
	 	set board_Title=#{boardTitle}, board_Content=#{boardContent}
	 	<if test="boardFilename !=null and boardFilename !=''">
	 		,board_Filename=#{boardFilename},board_Oldfilename=#{boardOldfilename}
	 		,board_Filesize=#{boardFilesize}
	 	</if>
	 	where BOARD_NO=#{boardNo}
	 </update>
</mapper>
