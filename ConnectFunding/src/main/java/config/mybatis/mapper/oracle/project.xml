<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.it.cf.project.model.ProjectDAO">	
	<select id="selectAll" parameterType="pageVo" resultType="projectVo">
		select *
		from
		(
			select rownum as RNUM, A.*
			from
			(	
				select * from PROJECT
				order by PROJECT_NO desc
			)A
		)
		<![CDATA[
		where RNUM > #{firstRecordIndex}
		and RNUM <= #{firstRecordIndex} + #{recordCountPerPage}
		]]>
	</select>
	
	<select id="selectBySecondCategoryNo" parameterType="pageVo" resultType="projectVo">
		select *
		from
		(
			select rownum as RNUM, A.*
			from
			(	
				select * from PROJECT
				<if test="secondCategoryNo!=0">
					where second_category_no=#{secondCategoryNo}
				</if>
				order by PROJECT_NO desc
			)A
		)
		<![CDATA[
		where RNUM > #{firstRecordIndex}
		and RNUM <= #{firstRecordIndex} + #{recordCountPerPage}
		]]>
	</select>
	
	<select id="selectFirstCategory" resultType="firstCategoryVo">
		select * from first_category
		order by first_category_no
	</select>
	
	<select id="selectSecondCategory" parameterType="string" resultType="secondCategoryVo">
		select s.*,f.category_name from second_category s join first_category f
		on s.first_category_no=f.first_category_no
		and f.category_name=#{firstCategory}
		order by s.second_category_no
	</select>
	
	<select id="selectTotalRecord" resultType="int">
		select count(*) from PROJECT
	</select>
	
	<select id="selectTotalRecordBySecondCategoryNo" parameterType="int" resultType="int">
		select count(*) from PROJECT
		<if test="secondCategoryNo!=0">
			where second_category_no=#{secondCategoryNo}
		</if>
	</select>
	
	<select id="selectTotalFundingAmountByFundingNo" parameterType="int" resultType="int">
		select total_funding_amount from TOTAL_FUNDING
		where FUNDING_NO=#{fundingNo}
	</select>
	
	<insert id="createTotalFunding" >
		insert into TOTAL_FUNDING(FUNDING_NO)
		values(total_funding_seq.nextval)
	</insert>
	
	<insert id="insertProject" parameterType="projectVo">
		insert into PROJECT(PROJECT_NO,PROJECT_NAME,project_summary,project_content,PROJECT_IMAGE,
			TOTAL_AMOUNT,PROJECT_STARTDATE,PROJECT_ENDDATE,USER_NO,FUNDING_NO,second_category_no) 
		values(project_seq.nextval,#{projectName},#{projectSummary},#{projectContent},#{projectImage},
			#{totalAmount},#{projectStartdate},
			#{projectEnddate},1,total_funding_seq.currval,#{secondCategoryNo})
	</insert>
	
</mapper>









